pkgname=libwebsockets-afunix
pkgver=3.1.0
pkgrel=2
pkgdesc="C library for websocket clients and servers (with enabled AF_UNIX)"
url="https://libwebsockets.org"
license=(LGPL)
arch=(i686 x86_64 armv6h armv7h)
depends=(openssl)
provides=(libwebsockets)
conflicts=(libwebsockets)
replaces=(libwebsockets)
makedepends=(cmake)
source=(${pkgname}::"git+https://github.com/warmcat/libwebsockets#commit=v${pkgver}")
md5sums=(SKIP)


build() {
	cd "$pkgname"
	mkdir build
	cd build
	cmake \
		-DCMAKE_BUILD_TYPE=Release \
		-DCMAKE_INSTALL_PREFIX:PATH=/usr \
		-DLWS_WITH_STATIC=OFF \
		-DLWS_LINK_TESTAPPS_DYNAMIC=ON \
		-DLWS_UNIX_SOCK=ON \
		..
	make $MAKEFLAGS
}

package() {
	cd "$pkgname/build"
	make DESTDIR="$pkgdir" install
	cd ..
	install -Dm644 LICENSE "$pkgdir/usr/share/licenses/$pkgname/LICENSE"
}
